// 设计 Token 单一数据源（SCSS → CSS 变量 + Tailwind @theme）
@use 'theme-tokens' as t;

@import 'tailwindcss';

// -----------------------------------------------------------------------------
// 全局 CSS 变量（与 frontend-main 风格一致，供非 Tailwind 与 Quasar 共用）
// -----------------------------------------------------------------------------
:root {
  // 主色
  --ev-color-primary: #{t.$primary};
  --ev-color-primary-light: #{t.$primary-light};
  --ev-color-primary-tint-bg: #{t.$primary-tint-bg};
  --ev-color-primary-tint-border: #{t.$primary-tint-border};
  --ev-color-primary-tint-border-strong: #{t.$primary-tint-border-strong};
  --ev-color-primary-tint-hover: #{t.$primary-tint-hover};
  --ev-color-primary-tint-bg-subtle: #{t.$primary-tint-bg-subtle};
  --ev-color-primary-header-glow: #{t.$primary-header-glow};
  --ev-color-accent: #{t.$accent};
  --ev-color-accent-tint: #{t.$accent-tint};
  --ev-color-secondary: #{t.$secondary};
  // 语义
  --ev-color-positive: #{t.$positive};
  --ev-color-negative: #{t.$negative};
  --ev-color-negative-tint: #{t.$negative-tint};
  --ev-color-info: #{t.$info};
  --ev-color-warning: #{t.$warning};
  --ev-scrollbar-thumb: #{t.$scrollbar-thumb};
  --ev-scrollbar-thumb-hover: #{t.$scrollbar-thumb-hover};
  // 背景与表面
  --ev-color-background: #{t.$background};
  --ev-color-background-elevated: #{t.$background-elevated};
  --ev-color-surface: #{t.$surface};
  --ev-color-surface-hover: #{t.$surface-hover};
  --ev-color-border: #{t.$border};
  --ev-color-border-strong: #{t.$border-strong};
  // 文字
  --ev-color-foreground: #{t.$foreground};
  --ev-color-foreground-muted: #{t.$foreground-muted};
  --ev-color-foreground-subtle: #{t.$foreground-subtle};
  // 玻璃/遮罩/高亮
  --ev-glass-bg: #{t.$glass-bg};
  --ev-glass-border: #{t.$glass-border};
  --ev-glass-border-subtle: #{t.$glass-border-subtle};
  --ev-glass-grid: #{t.$glass-grid};
  --ev-overlay-bg: #{t.$overlay-bg};
  --ev-node-dot: #{t.$node-dot};
  --ev-glow-cyan: #{t.$glow-cyan};
  --ev-mask-light: #{t.$mask-light};
  --ev-overlay-muted: #{t.$overlay-muted};
  --ev-scrollbar-size: #{t.$scrollbar-size};
  --ev-glass-blur: #{t.$glass-blur};
  --ev-glass-blur-sm: #{t.$glass-blur-sm};
  --ev-shadow-uppy-item: #{t.$shadow-uppy-item};
  // 字体
  --ev-font-sans: #{t.$font-sans};
  --ev-font-mono: #{t.$font-mono};
  --ev-font-size-xs: #{t.$font-size-xs};
  --ev-font-size-sm: #{t.$font-size-sm};
  --ev-font-size-base: #{t.$font-size-base};
  --ev-font-size-lg: #{t.$font-size-lg};
  --ev-font-size-xl: #{t.$font-size-xl};
  --ev-font-size-2xl: #{t.$font-size-2xl};
  --ev-font-weight-normal: #{t.$font-weight-normal};
  --ev-font-weight-medium: #{t.$font-weight-medium};
  --ev-font-weight-semibold: #{t.$font-weight-semibold};
  --ev-font-weight-bold: #{t.$font-weight-bold};
  --ev-line-height-tight: #{t.$line-height-tight};
  --ev-line-height-normal: #{t.$line-height-normal};
  --ev-line-height-relaxed: #{t.$line-height-relaxed};
  // 间距
  --ev-space-1: #{t.$space-1};
  --ev-space-2: #{t.$space-2};
  --ev-space-3: #{t.$space-3};
  --ev-space-4: #{t.$space-4};
  --ev-space-5: #{t.$space-5};
  --ev-space-6: #{t.$space-6};
  --ev-space-8: #{t.$space-8};
  --ev-space-10: #{t.$space-10};
  --ev-space-12: #{t.$space-12};
  // 圆角
  --ev-radius-sm: #{t.$radius-sm};
  --ev-radius-md: #{t.$radius-md};
  --ev-radius-lg: #{t.$radius-lg};
  --ev-radius-xl: #{t.$radius-xl};
  // 阴影
  --ev-shadow-sm: #{t.$shadow-sm};
  --ev-shadow-md: #{t.$shadow-md};
  --ev-shadow-lg: #{t.$shadow-lg};
  --ev-shadow-glow: #{t.$shadow-glow};
  --ev-shadow-primary: #{t.$shadow-primary};
  --ev-shadow-primary-hover: #{t.$shadow-primary-hover};
  // 布局与组件
  --ev-header-height: #{t.$header-height};
  --ev-drawer-width: #{t.$drawer-width};
  --ev-nav-item-height: #{t.$nav-item-height};
  --ev-nav-icon-size: #{t.$nav-icon-size};
  --ev-avatar-size: #{t.$avatar-size};
  --ev-button-height: #{t.$button-height};
  --ev-login-card-max-width: #{t.$login-card-max-width};
  --ev-glow-3-bottom: #{t.$glow-3-bottom};
  --ev-glow-3-right: #{t.$glow-3-right};
  --ev-glow-size-lg: #{t.$glow-size-lg};
  --ev-glow-size-md: #{t.$glow-size-md};
  --ev-glow-size-sm: #{t.$glow-size-sm};
  --ev-blur-glow: #{t.$blur-glow};
  --ev-glow-opacity: #{t.$glow-opacity};
  --ev-glow-opacity-subtle: #{t.$glow-opacity-subtle};
  --ev-title-display-size: #{t.$title-display-size};
  --ev-title-icon-size: #{t.$title-icon-size};
  --ev-content-max-width-sm: #{t.$content-max-width-sm};
  --ev-dashboard-height: #{t.$dashboard-height};
  --ev-dashboard-max-height: #{t.$dashboard-max-height};
  --ev-spinner-size-lg: #{t.$spinner-size-lg};
  --ev-nav-indicator-width: #{t.$nav-indicator-width};
  --ev-nav-indicator-height: #{t.$nav-indicator-height};
  --ev-nav-icon-inner: #{t.$nav-icon-inner};
  --ev-button-lift: #{t.$button-lift};
  // 视觉细节
  --ev-focus-ring: #{t.$focus-ring};
  --ev-nav-active-glow: #{t.$nav-active-glow};
  --ev-nav-active-accent: #{t.$nav-active-accent};
  --ev-card-border-gradient: #{t.$card-border-gradient};
  --ev-card-border-gradient-subtle: #{t.$card-border-gradient-subtle};
  --ev-gradient-primary-subtle: #{t.$gradient-primary-subtle};
  // 动效
  --ev-transition-fast: #{t.$transition-fast};
  --ev-transition-base: #{t.$transition-base};
  // Z-index
  --ev-z-dropdown: #{t.$z-dropdown};
  --ev-z-sticky: #{t.$z-sticky};
  --ev-z-modal: #{t.$z-modal};
  --ev-z-toast: #{t.$z-toast};
}

// -----------------------------------------------------------------------------
// Tailwind v4 @theme：与设计 Token 对齐，生成 tw-* 工具类
// -----------------------------------------------------------------------------
@theme {
  --color-primary: var(--ev-color-primary);
  --color-primary-light: var(--ev-color-primary-light);
  --color-accent: var(--ev-color-accent);
  --color-background: var(--ev-color-background);
  --color-background-elevated: var(--ev-color-background-elevated);
  --color-surface: var(--ev-color-surface);
  --color-foreground: var(--ev-color-foreground);
  --color-foreground-muted: var(--ev-color-foreground-muted);
  --color-foreground-subtle: var(--ev-color-foreground-subtle);
  --color-border: var(--ev-color-border);
  --color-positive: var(--ev-color-positive);
  --color-negative: var(--ev-color-negative);
  --color-info: var(--ev-color-info);
  --color-warning: var(--ev-color-warning);
  --font-sans: var(--ev-font-sans);
  --font-mono: var(--ev-font-mono);
  --font-size-xs: var(--ev-font-size-xs);
  --font-size-sm: var(--ev-font-size-sm);
  --font-size-base: var(--ev-font-size-base);
  --font-size-lg: var(--ev-font-size-lg);
  --font-size-xl: var(--ev-font-size-xl);
  --font-size-2xl: var(--ev-font-size-2xl);
  --radius-sm: var(--ev-radius-sm);
  --radius-md: var(--ev-radius-md);
  --radius-lg: var(--ev-radius-lg);
  --radius-xl: var(--ev-radius-xl);
  --shadow-sm: var(--ev-shadow-sm);
  --shadow-md: var(--ev-shadow-md);
  --shadow-lg: var(--ev-shadow-lg);
  --shadow-glow: var(--ev-shadow-glow);
}

// -----------------------------------------------------------------------------
// 基础层：后台管理面板全局样式
// -----------------------------------------------------------------------------
@layer base {
  body {
    background-color: var(--ev-color-background);
    color: var(--ev-color-foreground);
    font-family: var(--ev-font-sans);
    font-size: var(--ev-font-size-base);
    line-height: var(--ev-line-height-normal);
    -webkit-font-smoothing: antialiased;
  }

  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      transition-duration: 0.01ms !important;
      transition-delay: 0s !important;
      animation-duration: 0.01ms !important;
    }
  }
}

// -----------------------------------------------------------------------------
// 主布局侧栏：强制深色，覆盖 Quasar 默认白底
// -----------------------------------------------------------------------------
.main-layout__drawer,
.main-layout__drawer.q-drawer,
.main-layout__drawer .q-drawer__content,
.main-layout__drawer .q-scrollarea,
.main-layout__drawer .q-scrollarea__thumb,
.main-layout__drawer .q-list {
  background: var(--ev-color-background-elevated) !important;
}
.main-layout__drawer .q-item {
  background: transparent !important;
}
.main-layout__drawer .q-item:hover,
.main-layout__drawer .q-item.q-router-link--active {
  background: var(--ev-color-surface-hover) !important;
}

// -----------------------------------------------------------------------------
// 滚动条统一：原生滚动 + Quasar QScrollArea 使用同一套 token
// -----------------------------------------------------------------------------
.ev-scrollbar::-webkit-scrollbar,
.q-scrollarea__content::-webkit-scrollbar {
  width: var(--ev-scrollbar-size);
  height: var(--ev-scrollbar-size);
}
.ev-scrollbar::-webkit-scrollbar-track,
.q-scrollarea__content::-webkit-scrollbar-track {
  background: var(--ev-color-surface-hover);
  border-radius: var(--ev-radius-sm);
}
.ev-scrollbar::-webkit-scrollbar-thumb,
.q-scrollarea__content::-webkit-scrollbar-thumb {
  background: var(--ev-scrollbar-thumb);
  border-radius: var(--ev-radius-sm);
  transition: background var(--ev-transition-fast);
}
.ev-scrollbar::-webkit-scrollbar-thumb:hover,
.q-scrollarea__content::-webkit-scrollbar-thumb:hover {
  background: var(--ev-scrollbar-thumb-hover);
}
/* Quasar 自定义滚动条拇指（部分场景） */
.q-scrollarea__thumb {
  background: var(--ev-scrollbar-thumb) !important;
  border-radius: var(--ev-radius-sm);
  transition: background var(--ev-transition-fast);
}
.q-scrollarea__thumb:hover {
  background: var(--ev-scrollbar-thumb-hover) !important;
}

// -----------------------------------------------------------------------------
// 工具类：玻璃卡、主按钮、动效
// -----------------------------------------------------------------------------
@layer utilities {
  .ev-glass-card {
    background: var(--ev-glass-bg);
    backdrop-filter: blur(var(--ev-glass-blur));
    -webkit-backdrop-filter: blur(var(--ev-glass-blur));
    border: 1px solid var(--ev-glass-border-subtle);
    transition:
      background var(--ev-transition-base),
      box-shadow var(--ev-transition-base),
      border-color var(--ev-transition-base);
    position: relative;
  }
  .ev-glass-card::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit;
    padding: 1px;
    background: var(--ev-card-border-gradient-subtle);
    -webkit-mask:
      linear-gradient(var(--ev-mask-light) 0 0) content-box,
      linear-gradient(var(--ev-mask-light) 0 0);
    mask:
      linear-gradient(var(--ev-mask-light) 0 0) content-box,
      linear-gradient(var(--ev-mask-light) 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    pointer-events: none;
    opacity: 0;
    transition: opacity var(--ev-transition-base);
  }
  .ev-glass-card:hover {
    background: var(--ev-color-surface-hover);
    border-color: var(--ev-color-primary-tint-border);
    box-shadow: var(--ev-shadow-lg);
  }
  .ev-glass-card:hover::before {
    opacity: 1;
  }

  .ev-btn-primary {
    height: var(--ev-button-height);
    font-size: var(--ev-font-size-base);
    font-weight: var(--ev-font-weight-medium);
    letter-spacing: 0.04em;
    color: var(--ev-color-foreground);
    background: linear-gradient(
      135deg,
      var(--ev-color-primary) 0%,
      var(--ev-color-primary-light) 100%
    );
    border-radius: var(--ev-radius-lg);
    box-shadow: var(--ev-shadow-primary);
    transition: var(--ev-transition-base);
    border: none;
    &:hover {
      box-shadow: var(--ev-shadow-primary-hover);
      transform: translateY(calc(-1 * var(--ev-button-lift)));
    }
    &:active {
      transform: translateY(0);
    }
    &:focus-visible {
      outline: none;
      box-shadow: var(--ev-shadow-primary), var(--ev-focus-ring);
    }
    @media (prefers-reduced-motion: reduce) {
      &:hover {
        transform: none;
      }
      &:active {
        transform: none;
      }
    }
  }

  // 列表页：根卡片（与 ev-glass-card 同用）
  .ev-list-card {
    position: relative;
    padding: 0;
    border-radius: var(--ev-radius-xl);
    box-shadow: var(--ev-shadow-lg);
    overflow: hidden;
    &:hover {
      box-shadow: var(--ev-shadow-lg), var(--ev-shadow-glow);
      border-color: var(--ev-color-primary-tint-border);
    }
  }

  // 列表页：表格统一样式（透明背景、表头渐变、行 hover、分页区）
  .ev-table-theme {
    background: transparent !important;
    overflow-x: auto;
    min-width: 0;
  }
  .ev-table-theme .q-table__container {
    overflow-x: auto;
    border: none;
    box-shadow: none;
  }
  .ev-table-theme .q-table__top,
  .ev-table-theme .q-table__bottom {
    background: transparent;
    border-top: none !important;
  }
  .ev-table-theme thead tr {
    background: linear-gradient(180deg, var(--ev-color-primary-tint-bg-subtle) 0%, transparent 100%);
    border-bottom: 1px solid var(--ev-color-border);
  }
  .ev-table-theme thead tr th {
    border: none;
    background: transparent;
    padding: var(--ev-space-4) var(--ev-space-5);
    font-size: var(--ev-font-size-xs);
    font-weight: var(--ev-font-weight-semibold);
    letter-spacing: 0.05em;
    text-transform: uppercase;
    color: var(--ev-color-foreground-muted);
  }
  .ev-table-theme tbody tr {
    transition: background var(--ev-transition-fast);
  }
  .ev-table-theme tbody tr:hover td {
    background: var(--ev-color-surface-hover);
  }
  .ev-table-theme .q-table tbody td {
    padding: var(--ev-space-3) var(--ev-space-5);
    font-size: var(--ev-font-size-sm);
    color: var(--ev-color-foreground-muted);
    border-bottom: 1px solid var(--ev-color-border);
  }
  .ev-table-theme .q-table tbody tr:last-child td {
    border-bottom: none;
  }

  .ev-table-empty-state {
    padding: var(--ev-space-10) var(--ev-space-6);
    text-align: center;
    color: var(--ev-color-foreground-muted);
    font-size: var(--ev-font-size-sm);
    line-height: var(--ev-line-height-relaxed);
  }
  .ev-table-empty-state .q-icon {
    display: block;
    margin: 0 auto var(--ev-space-3);
    opacity: 0.6;
  }

  .ev-table-theme .ev-table-pagination-wrap {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    width: 100%;
    padding: var(--ev-space-4) var(--ev-space-5);
    background: transparent;
    border-top: 1px solid var(--ev-color-border);
  }

  .ev-table-pagination {
    flex-shrink: 0;
  }
  .ev-table-pagination .q-btn {
    color: var(--ev-color-foreground-muted);
    border-radius: var(--ev-radius-md);
  }
  .ev-table-pagination .q-btn:hover,
  .ev-table-pagination .q-btn.q-btn--active {
    color: var(--ev-color-primary-light);
    background: var(--ev-color-primary-tint-bg);
  }
  .ev-table-pagination .q-btn:focus-visible {
    outline: none;
    box-shadow: var(--ev-focus-ring);
  }
}

// -----------------------------------------------------------------------------
// 错误条：统一使用 token，保证对比度
// -----------------------------------------------------------------------------
.ev-banner-error {
  background: var(--ev-color-negative-tint) !important;
  border: 1px solid var(--ev-color-negative);
  border-radius: var(--ev-radius-md);
  color: var(--ev-color-foreground);
  padding: var(--ev-space-4);
  .q-banner__content {
    color: var(--ev-color-foreground);
  }
}

// -----------------------------------------------------------------------------
// 通知条样式（与设计 token 一致，Quasar Notify 使用 .ev-notify 类）
// -----------------------------------------------------------------------------
.ev-notify {
  font-family: var(--ev-font-sans);
  font-size: var(--ev-font-size-sm);
  font-weight: var(--ev-font-weight-medium);
  border-radius: var(--ev-radius-lg);
  border: 1px solid transparent;
  box-shadow: var(--ev-shadow-md);
  backdrop-filter: blur(var(--ev-glass-blur-sm));
}
.ev-notify--success {
  background: var(--ev-color-surface);
  border-color: var(--ev-color-positive);
  color: var(--ev-color-foreground);
  .q-notify__progress {
    background: var(--ev-color-positive);
  }
}
.ev-notify--error {
  background: var(--ev-color-surface);
  border-color: var(--ev-color-negative);
  color: var(--ev-color-foreground);
  .q-notify__progress {
    background: var(--ev-color-negative);
  }
}
.ev-notify--warning {
  background: var(--ev-color-surface);
  border-color: var(--ev-color-warning);
  color: var(--ev-color-foreground);
  .q-notify__progress {
    background: var(--ev-color-warning);
  }
}
.ev-notify--info {
  background: var(--ev-color-surface);
  border-color: var(--ev-color-info);
  color: var(--ev-color-foreground);
  .q-notify__progress {
    background: var(--ev-color-info);
  }
}
